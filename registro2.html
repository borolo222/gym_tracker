<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strength Logger</title>
    
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. Vue.js for interactivity -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Basic styling for dark mode and to prevent "flash of unstyled content" -->
    <style>
        body { background-color: #111827; color: #d1d5db; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8">

    <!-- This is the main container for our Vue app -->
    <div id="app" v-cloak>

        <h1 class="text-3xl font-bold text-white text-center mb-4">Strength Logger</h1>

        <!-- WORKOUT SELECTION -->
        <div class="mb-6 bg-gray-800 p-4 rounded-lg">
            <h2 class="font-bold text-lg mb-2 text-white">Select Workout</h2>
            <div class="grid grid-cols-3 gap-2">
                <button @click="selectWorkout('Push')" :class="{'bg-indigo-600 text-white': currentWorkout.workoutType === 'Push', 'bg-gray-700 hover:bg-gray-600': currentWorkout.workoutType !== 'Push'}" class="p-2 rounded-md font-semibold transition-colors">Push</button>
                <button @click="selectWorkout('Pull')" :class="{'bg-indigo-600 text-white': currentWorkout.workoutType === 'Pull', 'bg-gray-700 hover:bg-gray-600': currentWorkout.workoutType !== 'Pull'}" class="p-2 rounded-md font-semibold transition-colors">Pull</button>
                <button @click="selectWorkout('Legs')" :class="{'bg-indigo-600 text-white': currentWorkout.workoutType === 'Legs', 'bg-gray-700 hover:bg-gray-600': currentWorkout.workoutType !== 'Legs'}" class="p-2 rounded-md font-semibold transition-colors">Legs</button>
            </div>
        </div>

        <!-- WORKOUT DETAILS (only shows if a workout is selected) -->
        <div v-if="currentWorkout.workoutType" class="space-y-4">
            <div class="flex justify-between items-center bg-gray-800 p-4 rounded-lg">
                <input type="date" v-model="currentWorkout.date" class="bg-gray-700 p-2 rounded-md w-1/2">
                <button @click="exportToJson" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-md">Export JSON</button>
            </div>

            <!-- EXERCISE CARDS -->
            <div v-for="exercise in currentWorkout.exercises" :key="exercise.name" class="bg-gray-800 rounded-lg shadow-md">
                <!-- Collapsible Header -->
                <div @click="exercise.isOpen = !exercise.isOpen" class="p-4 flex justify-between items-center cursor-pointer border-b border-gray-700">
                    <h3 class="text-xl font-bold text-white">{{ exercise.name }}</h3>
                    <span class="text-2xl transition-transform" :class="{'rotate-180': !exercise.isOpen}">&#9660;</span>
                </div>
                
                <!-- Collapsible Content -->
                <div v-show="exercise.isOpen" class="p-4">
                    <!-- Set Headers -->
                    <div class="grid grid-cols-12 gap-2 text-xs text-gray-400 mb-2 font-bold">
                        <div class="col-span-3">Weight</div>
                        <div class="col-span-4">Unit/Type</div>
                        <div class="col-span-2">Reps</div>
                        <div class="col-span-2">RIR</div>
                    </div>
                    
                    <!-- Set Rows -->
                    <div v-for="(set, index) in exercise.sets" :key="index" class="grid grid-cols-12 gap-2 items-center mb-2">
                        <input type="number" v-model.number="set.weight" class="col-span-3 bg-gray-700 p-2 rounded-md">
                        <div class="col-span-4 flex gap-1">
                            <select v-model="set.unit" class="bg-gray-700 p-2 rounded-md w-full text-xs">
                                <option>Kg</option>
                                <option>Lbs</option>
                            </select>
                            <select v-model="set.type" class="bg-gray-700 p-2 rounded-md w-full text-xs">
                                <option>total</option>
                                <option>per hand</option>
                            </select>
                        </div>
                        <input type="number" v-model.number="set.reps" class="col-span-2 bg-gray-700 p-2 rounded-md">
                        <input type="number" v-model.number="set.rir" class="col-span-2 bg-gray-700 p-2 rounded-md">
                    </div>

                    <!-- Add Set Button -->
                    <button @click="addSet(exercise)" class="mt-2 bg-indigo-500 hover:bg-indigo-400 text-white text-sm font-bold py-2 px-3 rounded-md w-full">Add Set</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. All of our Vue.js Application Logic -->
    <script>
        const { createApp, ref, watch, onMounted } = Vue;

        createApp({
            setup() {
                // --- DATA ---

                // This is the main reactive object that holds the entire state of our app
                const currentWorkout = ref({
                    date: new Date().toISOString().slice(0, 10),
                    workoutType: null,
                    exercises: []
                });

                // This is a template for creating new workouts
                const workoutTemplates = {
                    "Push": ["Bench Press Machine", "Seated Dumbbell Shoulder Press", "Incline Dumbbell Press", "Cable Tricep Pushdowns", "Lateral Raises"],
                    "Pull": ["Barbell RDLs", "Seated Cable Rows", "Lat Pulldowns", "Incline Dumbbell Curls", "Face Pulls", "Hammer Curls"],
                    "Legs": ["Leg Press Machine", "Bulgarian Split Squats", "Leg Curls", "Leg Extensions", "Calf Raises"]
                };

                // --- METHODS ---

                const createNewSet = () => ({ weight: null, unit: 'Kg', type: 'total', reps: null, rir: null });

                const selectWorkout = (type) => {
                    // Ask for confirmation to prevent accidental data loss
                    if (currentWorkout.value.exercises.length > 0 && !confirm('Are you sure you want to start a new workout? Current progress will be lost.')) {
                        return;
                    }
                    
                    currentWorkout.value.workoutType = type;
                    currentWorkout.value.exercises = workoutTemplates[type].map(name => ({
                        name: name,
                        isOpen: true, // Make cards open by default
                        sets: [createNewSet()] // Start with one empty set
                    }));
                };

                const addSet = (exercise) => {
                    exercise.sets.push(createNewSet());
                };
                
                const exportToJson = () => {
                    // Create a clean version of the data for export
                    const exportData = {
                        Date: currentWorkout.value.date,
                        WorkoutType: currentWorkout.value.workoutType,
                        Exercises: currentWorkout.value.exercises.map(ex => ({
                            ExerciseName: ex.name,
                            Sets: ex.sets.map(set => ({
                                Weight: set.weight,
                                Unit: set.unit,
                                Type: set.type,
                                Reps: set.reps,
                                RIR: set.rir
                            }))
                        }))
                    };

                    const jsonString = JSON.stringify(exportData, null, 2);
                    navigator.clipboard.writeText(jsonString).then(() => {
                        alert('Workout JSON copied to clipboard!');
                    }).catch(err => {
                        console.error('Failed to copy text: ', err);
                        alert('Failed to copy JSON. See console for details.');
                    });
                };

                // --- LIFECYCLE & PERSISTENCE ---

                // Watch for any changes in the workoutData object and save it
                watch(currentWorkout, (newData) => {
                    localStorage.setItem('strengthLoggerData', JSON.stringify(newData));
                }, { deep: true });

                // When the app first loads, try to get data from localStorage
                onMounted(() => {
                    const savedData = localStorage.getItem('strengthLoggerData');
                    if (savedData) {
                        currentWorkout.value = JSON.parse(savedData);
                    }
                });

                // Expose all our data and methods to the HTML template
                return {
                    currentWorkout,
                    selectWorkout,
                    addSet,
                    exportToJson
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
